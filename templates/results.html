<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head>
  <meta charset="UTF-8" />
  <title>Results - AI Resume Ranker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      background: radial-gradient(1100px 600px at 10% -10%, #e9f1ff 0%, transparent 55%),
        radial-gradient(1000px 500px at 100% 0%, #eafff4 0%, transparent 55%),
        linear-gradient(180deg, #f7f8fb 0%, #ffffff 70%);
      min-height: 100dvh;
      transition: background-color 0.3s ease;
    }

    [data-bs-theme="dark"] body {
      background: radial-gradient(1100px 600px at 10% -10%, #2c2f38 0%, transparent 55%),
        radial-gradient(1000px 500px at 100% 0%, #343a44 0%, transparent 55%),
        linear-gradient(180deg, #2a2f3a 0%, #181d25 70%);
    }

    .blur-card {
      background: rgba(255, 255, 255, .85);
      border: 1px solid rgba(0, 0, 0, .06);
      border-radius: 1rem;
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 30px rgba(16, 24, 40, .06);
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }

    [data-bs-theme="dark"] .blur-card {
      background: rgba(20, 22, 25, .6);
      border-color: rgba(255, 255, 255, .06);
      box-shadow: 0 10px 30px rgba(16, 24, 40, .2);
    }

    .navbar-dark {
      background-color: #343a44;
      transition: background-color 0.3s ease;
    }

    [data-bs-theme="dark"] .navbar-dark {
      background-color: #1b1f26;
    }

    .table-dark {
      background-color: #2c2f38;
    }

    .table-dark th, .table-dark td {
      color: #e9f1ff;
    }

    [data-bs-theme="dark"] .table-dark th, [data-bs-theme="dark"] .table-dark td {
      color: #cfd8e3;
    }

    .navbar-brand, .nav-link {
      color: #ffffff;
      transition: color 0.3s ease;
    }

    [data-bs-theme="dark"] .navbar-brand, [data-bs-theme="dark"] .nav-link {
      color: #e1e1e1;
    }

    .form-control, .input-group-sm .form-control, .btn-outline-secondary, .btn-outline-primary, .badge-soft {
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    [data-bs-theme="dark"] .form-control, [data-bs-theme="dark"] .input-group-sm .form-control {
      background-color: #3a3f48;
      color: #ffffff;
      border-color: #4e555d;
    }

    [data-bs-theme="dark"] .btn-outline-secondary, [data-bs-theme="dark"] .btn-outline-primary {
      background-color: transparent;
      color: #ffffff;
      border-color: #4e555d;
    }

    .score-bar {
      height: .75rem;
      border-radius: .5rem;
      background: rgba(13, 110, 253, .15);
      overflow: hidden;
      transition: background-color 0.3s ease;
    }

    [data-bs-theme="dark"] .score-bar {
      background: rgba(0, 123, 255, .15);
    }

    .highlight {
      background: #fff3cd;
      padding: 0 .25rem;
      border-radius: .25rem;
    }

    [data-bs-theme="dark"] .highlight {
      background: #494949;
    }

    .badge-soft {
      background-color: rgba(13, 110, 253, .12);
      color: #0d6efd;
    }

    [data-bs-theme="dark"] .badge-soft {
      background-color: rgba(13, 110, 253, .18);
      color: #88c8ff;
    }

    .tiny {
      font-size: .925rem;
      color: #667085;
    }

    [data-bs-theme="dark"] .tiny {
      color: #98a2b3;
    }

    .modal-content {
      background-color: #2c2f38;
      color: #e9f1ff;
      max-height: 80vh;
      overflow-y: auto;
    }

    [data-bs-theme="dark"] .modal-content {
      background-color: #181d25;
    }

    .modal-header {
      border-bottom: 1px solid #4e555d;
    }

    [data-bs-theme="dark"] .modal-header {
      border-bottom: 1px solid #888;
    }

    .modal-backdrop {
      z-index: -1;
    }

    /* Make modal body scrollable */
    .modal-body {
      max-height: 60vh;
      overflow-y: auto;
    }

  </style>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-semibold" href="{{ url_for('index') }}">
        <i class="bi bi-stars me-2"></i>AI Resume Ranker
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="navMenu" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <!-- <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}"><i
                class="bi bi-house-door me-1"></i>Home</a></li> -->
          <li class="nav-item"><a class="nav-link active" href="#"><i class="bi bi-list-ol me-1"></i>Results</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('history') }}"><i
                class="bi bi-clock-history me-1"></i>Feedback History</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="py-4">
    <div class="container">
      <div class="d-flex flex-wrap gap-3 justify-content-between align-items-center">
        <div>
          <h2 class="mb-1">Top Ranked Candidates</h2>
          <div class="tiny">Sorted by match score. Use filters or click column headers to sort.</div>
        </div>
        <div class="d-flex align-items-center gap-3 toolbar-sticky">
          <span class="badge rounded-pill text-bg-primary-subtle text-primary px-3 py-2">
            <i class="bi bi-people me-1"></i> {{ ranked|length }} candidates
          </span>
          <div class="form-check form-switch m-0">
            <input class="form-check-input" type="checkbox" id="themeToggle">
            <label class="form-check-label" for="themeToggle"><i class="bi bi-moon-stars me-1"></i>Dark mode</label>
          </div>
          <a class="btn btn-outline-secondary" href="{{ url_for('reset') }}"><i class="bi bi-arrow-repeat me-1"></i>New
            Search</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container mb-5">
    <div class="blur-card p-4 p-lg-5">

      <!-- Filters (same GET names) -->
      <form method="GET" action="{{ url_for('index') }}" class="row g-3 align-items-end mb-4">
        <div class="col-md-3">
          <label class="form-label fw-semibold">Minimum Score</label>
          <input type="number" step="0.01" min="0" max="1" name="min_score" class="form-control"
            value="{{ request.args.get('min_score', 0) }}" placeholder="e.g. 0.65">
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">Minimum Experience (yrs)</label>
          <input type="number" min="0" name="min_exp" class="form-control" value="{{ request.args.get('min_exp', 0) }}"" 
            placeholder="e.g. 3">
        </div>
        <div class="col-md-4">
          <label class="form-label fw-semibold">Keyword Filter</label>
          <input type="text" name="keyword" id="kwInput" class="form-control"
            value="{{ request.args.get('keyword', '') }}" placeholder="Python, NLP, Kubernetes…">
        </div>
        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-primary"><i class="bi bi-search me-1"></i>Apply</button>
        </div>
      </form>

      <!-- Quick summary -->
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="p-3 rounded border bg-body">
            <div class="tiny text-secondary">Best score</div>
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-trophy text-warning"></i>
              <span class="fw-semibold">
                {% if ranked|length %}{{ "%.3f"|format(ranked[0].score) }}{% else %}—{% endif %} 
              </span>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="p-3 rounded border bg-body">
            <div class="tiny text-secondary">Avg experience (yrs)</div>
            <div class="fw-semibold">
              {% if ranked|length %}{{ "%.1f"|format(ranked|map(attribute='years_experience')|sum / (ranked|length))
              }}{% else %}—{% endif %}
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="p-3 rounded border bg-body">
            <div class="tiny text-secondary">Keyword</div>
            <span class="badge badge-soft" id="kwBadge">
              {% set kw = request.args.get('keyword','') %}
              {{ kw if kw else "None" }}
            </span>
          </div>
        </div>
      </div>

      <!-- Results table + feedback (same POST & names) -->
     <form method="POST" action="{{ url_for('feedback') }}">
  <div class="table-responsive">
    <table id="resultTable" class="table table-hover align-middle mb-3">
      <thead class="table-dark">
        <tr>
          <th>Filename</th>
          <th>Skills</th>
          <th>Score</th>
          <th>Experience (yrs)</th>
          <th>Preview</th>
          <th>Download</th>
          <th>Decision</th>
        </tr>
      </thead>
      <tbody>
        {% for r in ranked %}
        <tr>
          <td class="filename-cell">{{ r.filename }}</td>
          <td>
            {% for skill in r.skills %}
            <span class="badge bg-light text-dark border me-1 mb-1">{{ skill }}</span>
            {% endfor %}
          </td>
          <td>{{ r.score }}</td>
          <td>{{ r.years_experience }}</td>
          <td>
            <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#previewModal{{ loop.index }}">📄 Preview</button>
          </td>
          <td>
            <a class="btn btn-outline-primary btn-sm" href="{{ url_for('download_resume', filename=r.filename) }}" download="{{ r.filename }}">Download</a>
          </td>
          <td>
            <!-- Feedback dropdown -->
            <div class="input-group input-group-sm">
              <select class="form-select" name="decision_{{ r.filename }}">
                <option value="">-- No decision --</option>
                <option value="selected">✅ Select</option>
                <option value="rejected">❌ Reject</option>
              </select>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="d-flex justify-content-between">
    <button type="submit" class="btn btn-success">Save Feedback</button>
  </div>
</form>

    </div>
  </main>

  <!-- Back to top -->
  <button id="toTop" class="btn btn-dark position-fixed bottom-0 end-0 m-4 d-none rounded-circle"
    style="width:48px;height:48px;"><i class="bi bi-chevron-up"></i></button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* ——— Theme memory ——— */
    const html = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) { html.setAttribute('data-bs-theme', savedTheme); themeToggle.checked = savedTheme === 'dark'; }
    else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      html.setAttribute('data-bs-theme', 'dark'); themeToggle.checked = true;
    }
    themeToggle.addEventListener('change', () => {
      const t = themeToggle.checked ? 'dark' : 'light';
      html.setAttribute('data-bs-theme', t);
      localStorage.setItem('theme', t);
    });

    /* ——— Back to top ——— */
    const toTop = document.getElementById('toTop');
    window.addEventListener('scroll', () => {
      toTop.classList.toggle('d-none', window.scrollY < 300);
    });
    toTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
  </script>
</body>

</html>
